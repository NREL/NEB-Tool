<div class="row">
    <div class="col-12">
        <h6>
            <fa-icon [icon]="faBullseye" class="me-2"></fa-icon>
            Selected Company KPI's
        </h6>
    </div>
</div>
<div class="row mb-2">
    <div class="col-4">
        <button class="btn btn-secondary w-100" (click)="openAddCustomModal()">
            <fa-icon [icon]="faPlus"></fa-icon>
            Add Custom
        </button>
    </div>
</div>

<ng-template [ngIf]="(company.guid | companyKpiList:keyPerformanceIndicators).length != 0" [ngIfElse]="noDataBlock">
    <div class="list-group">
        <div class="list-group-item list-group-item-action"
            *ngFor="let kpi of (company.guid | companyKpiList:keyPerformanceIndicators)">
            <div class="d-flex w-100 justify-content-between">
                <div>
                    <button class="btn btn-sm btn-danger" (click)="openDeleteModal(kpi)">
                        <fa-icon [icon]="faTrash"></fa-icon>
                    </button>
                    <span class="ps-1" [innerHTML]="kpi.label"></span>
                </div>
                <div>
                    <span class="badge" [ngStyle]="{'background-color':kpi.primaryKPI | kpiCategoryClass}">
                        {{kpi.primaryKPI}}
                    </span>
                </div>

            </div>
        </div>
    </div>
</ng-template>
<ng-template #noDataBlock>
    <div class="alert alert-info text-center">
        No KPI's selected for this company. Add KPI's from the list provided.
    </div>
</ng-template>


<!--custom KPI modal-->
<div [ngClass]="{'window-overlay': displayCustomKPIModal}"></div>
<div class="popup" [ngClass]="{'open': displayCustomKPIModal }">
    <div class="popup-header">Create Custom KPI?
        <button type="button" class="btn-close float-end" aria-label="Close" (click)="closeCustomKPIModal()"></button>
    </div>
    <div class="popup-body">
        <form>
            <div class="row mb-1">
                <label class="col-sm-5 col-form-label" for="customKPIName">Custom KPI Name</label>
                <div class="col-sm-7">
                    <input name="customKPIName" type="text" class="form-control" [(ngModel)]="customKPIName"
                        id="customKPIName">
                    <div class="alert alert-danger small mt-1 p-1" *ngIf="!customKPIName">
                        Name Required
                    </div>
                </div>
            </div>
            <div class="row mb-1">
                <label class="col-sm-5 col-form-label" for="kpiCategory">KPI Category</label>
                <div class="col-sm-7">
                    <select class="form-select" name="kpiCategory" id="kpiCategory" [(ngModel)]="kpiCategory">
                        <option *ngFor="let primaryKPI of primaryKPIs" [ngValue]="primaryKPI">{{primaryKPI}}</option>
                    </select>
                </div>
            </div>
        </form>
        <hr>
    </div>
    <div class="popup-footer d-flex justify-content-end">
        <button class="btn btn-secondary me-2" (click)="closeCustomKPIModal()">Cancel</button>
        <button class="btn btn-success" [disabled]="!customKPIName" (click)="confirmCreate()">Create Custom KPI</button>
    </div>
</div>

<!--delete KPI modal-->
<div [ngClass]="{'window-overlay': displayDeleteModal}"></div>
<div class="popup" [ngClass]="{'open': displayDeleteModal }">
    <div class="popup-header">Delete KPI
        <button type="button" class="btn-close float-end" aria-label="Close" (click)="closeDeleteModal()"></button>
    </div>
    <div class="popup-body">
        <div class="alert alert-danger">
            Are you sure you want to delete this KPI? Changes will be lost.
        </div>
        <hr>
    </div>
    <div class="popup-footer d-flex justify-content-end">
        <button class="btn btn-secondary me-2" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="removeKPI()"><fa-icon [icon]="faTrash"></fa-icon> Delete KPI</button>
    </div>
</div>

<!-- <ng-template [ngIf]="company.keyPerformanceIndicators.length != 0" [ngIfElse]="noDataBlock">

    <div class="accordion" id="kpiAccordion">
        <div class="accordion-item" *ngFor="let kpi of company.keyPerformanceIndicators; let kpiIndex = index;">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#'+kpi.kpiOptionValue" aria-expanded="true"
                    [attr.aria-controls]="kpi.kpiOptionValue" [ngClass]="{'collapsed': accordionIndex != kpiIndex}"
                    (click)="setAccordionIndex(kpiIndex)">
                    <div class="d-flex justify-content-between w-100">
                        <div class="p-0">
                            <fa-icon [icon]="faBullseye" class="pe-1"></fa-icon>
                            <span [innerHTML]="kpi | kpiLabel"></span>
                        </div>
                        <div class="pe-2">
                            <span class="badge" [ngStyle]="{'background-color':kpi.category | kpiCategoryClass}">
                                {{kpi.category}}
                            </span>
                        </div>
                    </div>

                </button>
            </h2>
            <div [id]="kpi.kpiOptionValue" class="accordion-collapse collapse" data-bs-parent="#kpiAccordion"
                [ngClass]="{'show': accordionIndex == kpiIndex}">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-12">
                            <form>
                                <div *ngIf="kpi.isCustom" class="row mb-1">
                                    <label class="col-sm-5 col-form-label" for="customKPIName">KPI Name</label>
                                    <div class="col-sm-7">
                                        <input name="customKPIName" type="text" class="form-control"
                                            [(ngModel)]="kpi.customKPIName" id="customKPIName">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label class="col-sm-5 col-form-label" for="kpiCategory">KPI
                                        Category</label>
                                    <div class="col-sm-7">
                                        <select [disabled]="!kpi.isCustom" name="kpiCategory" class="form-select"
                                            id="kpiCategory" [(ngModel)]="kpi.category" (change)="saveChanges()">
                                            <option *ngFor="let category of kpi_categories" [ngValue]="category">
                                                {{category}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label class="col-sm-5 col-form-label" for="isQualitative">Qualitative
                                        or
                                        Quantitative?</label>
                                    <div class="col-sm-7">
                                        <select [disabled]="!kpi.isCustom" name="isQualitative" class="form-select"
                                            id="isQualitative" [(ngModel)]="kpi.isQualitative" (change)="saveChanges()">
                                            <option [ngValue]="true">
                                                Qualitative
                                            </option>
                                            <option [ngValue]="false">
                                                Quantitative
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <ng-container *ngIf="!kpi.isQualitative">
                                    <div class="row mb-1">
                                        <label class="col-sm-5 col-form-label" for="units">Units</label>
                                        <div class="col-sm-7">
                                            <select name="units" class="form-select" id="units" [(ngModel)]="kpi.units"
                                                (change)="saveChanges()">
                                                <option *ngFor="let unitOption of kpi.kpiOptionValue | kpiUnitOption"
                                                    [ngValue]="unitOption">
                                                    {{unitOption}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <label class="col-sm-5 col-form-label" for="baselineUsePerYear">Baseline Use
                                            Per
                                            Year</label>
                                        <div class="col-sm-7">
                                            <div class="input-group">
                                                <input name="baselineUsePerYear" type="number" class="form-control"
                                                    [(ngModel)]="kpi.baselineUsePerYear" id="baselineUsePerYear"
                                                    (input)="saveChanges()">
                                                <span class="input-group-text">{{kpi.units}}/yr</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <label class="col-sm-5 col-form-label" for="costPerUnit">Cost
                                            Per
                                            Unit</label>
                                        <div class="col-sm-7">
                                            <div class="input-group">
                                                <input name="costPerUnit" type="number" class="form-control"
                                                    [(ngModel)]="kpi.costPerUnit" id="costPerUnit"
                                                    (input)="saveChanges()">
                                                <span class="input-group-text">&dollar;</span>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </form>
                        </div>
                        <div class="col-12">
                            <hr>
                        </div>
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <div class="col-6">
                                    <button class="btn btn-sm btn-primary me-1"
                                        *ngFor="let contact of kpi.kpiOptionValue| contactName:'KPI': contacts;"
                                        (click)="openContactModal(kpiIndex, contact)">
                                        <fa-icon [icon]="faUser"></fa-icon>
                                        {{contact.name}}
                                    </button>
                                    <button class="btn btn-sm btn-secondary"
                                        (click)="openContactModal(kpiIndex, undefined)">
                                        <fa-icon [icon]="faUser"></fa-icon>
                                        Team Members
                                    </button>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-danger" (click)="openDeleteModal(kpi)">
                                        <fa-icon [icon]="faTrash"></fa-icon> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #noDataBlock>
    <div class="alert alert-info text-center">
        No KPI's selected for this company. Add KPI's from the list provided.
    </div>
</ng-template>






<app-contact-modal *ngIf="displayContactModal" (emitCancelContact)="closeContactModal()"
    [contextGuid]="company.keyPerformanceIndicators[contactIndex].kpiOptionValue" [contactContext]="'KPI'"
    [selectedContact]="viewContact" [companyGuid]="company.guid"></app-contact-modal> -->