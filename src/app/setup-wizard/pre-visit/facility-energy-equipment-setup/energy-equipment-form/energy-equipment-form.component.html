<div class="row">
    <div class="col-12">
        <form>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="equipmentName">Equipment
                    Name</label>
                <div class="col-sm-7">
                    <input name="equipmentName" type="text" class="form-control"
                        [(ngModel)]="energyEquipment.equipmentName"
                        id="equipmentName" (input)="saveChanges()">
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="equipmentType">Industrial System</label>
                <div class="col-sm-7">
                    <select name="equipmentType" class="form-select"
                        id="equipmentType"
                        [(ngModel)]="energyEquipment.equipmentType"
                        (change)="calculateAnnualEnergyUse()">
                        <option *ngFor="let option of equipmentTypeOptions"
                            [ngValue]="option">
                            {{option}}
                        </option>
                    </select>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="utilityType">Utility
                    Type</label>
                <div class="col-sm-7">
                    <select name="utilityType" class="form-select" id="utilityType"
                        [(ngModel)]="energyEquipment.utilityType"
                        (change)="calculateAnnualEnergyUse()">
                        <option *ngFor="let option of utilityTypes"
                            [ngValue]="option">
                            {{option}}
                        </option>
                    </select>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="size">Total Size</label>
                <div class="col-sm-7">
                    <div class="input-group">
                        <input type="number" class="form-control" name="size"
                            [(ngModel)]="energyEquipment.size"
                            (input)="calculateAnnualEnergyUse()">
                        <select  class="input-group-text" id="sizeUnit" name="sizeUnit"
                            [(ngModel)]="energyEquipment.sizeUnit"
                            (change)="calculateAnnualEnergyUse()">
                            <option *ngFor="let option of (energyEquipment.utilityType | linkedUnitOptions)"
                                [ngValue]="energyEquipment.sizeUnit">
                                <span [innerHTML]="option.value | unitsDisplay"></span>
                            </option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label"
                    for="operatingHours">Operating
                    Hours</label>
                <div class="col-sm-7">
                    <div class="input-group">
                        <input type="number" class="form-control"
                            name="operatingHours"
                            [(ngModel)]="energyEquipment.operatingHours"
                            (input)="calculateAnnualEnergyUse()">
                        <span class="input-group-text">Hrs/yr</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="loadFactor">Load
                    Factor</label>
                <div class="col-sm-7">
                    <div class="input-group">
                        <input type="number" class="form-control" name="loadFactor"
                            [(ngModel)]="energyEquipment.loadFactor"
                            (input)="calculateAnnualEnergyUse()">
                        <span class="input-group-text">&percnt;</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label"
                    for="efficiency">Efficiency</label>
                <div class="col-sm-7">
                    <div class="input-group">
                        <input type="number" class="form-control"
                            name="efficiency"
                            [(ngModel)]="energyEquipment.efficiency"
                            (input)="calculateAnnualEnergyUse()">
                        <span class="input-group-text">&percnt;</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label"
                    for="numberOfEquipment">Number of Equipment</label>
                <div class="col-sm-7">
                    <div class="input-group">
                        <input type="number" class="form-control"
                            name="numberOfEquipment"
                            [(ngModel)]="energyEquipment.numberOfEquipment"
                            (input)="calculateAnnualEnergyUse()">
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="notes">Notes</label>
                <div class="col-sm-7">
                    <textarea class="form-control" name="notes"
                        [(ngModel)]="energyEquipment.notes"
                        (input)="saveChanges()"></textarea>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label" for="energyUse">Annual Energy Use</label>
                <div class="col-sm-7">
                    <span class="d-flex justify-content-center bold"
                    name="energyUse">{{energyEquipment.annualEnergyUse.toFixed(2)}} kWh</span>
                </div>
            </div>
        </form>
    </div>
    <div class="col-12">
        <hr>
    </div>
    <div class="col-12">
        <div class="d-flex justify-content-between">
            <div class="col-6">
                <button class="btn btn-sm btn-primary me-1"
                    *ngFor="let contact of energyEquipment.guid | associatedContacts:'energyEquipment': contacts;"
                    (click)="openContactModal(contact)">
                    <fa-icon [icon]="faUser"></fa-icon>
                    {{contact | contactNameDisplay}}
                </button>
                <button class="btn btn-sm btn-secondary"
                    (click)="openContactModal(undefined)">
                    <fa-icon [icon]="faContactBook"></fa-icon>
                    Stakeholders
                </button>
            </div>
            <div>
                <button class="btn btn-sm btn-danger"
                    (click)="openDeleteModal()">
                    <fa-icon [icon]="faTrash"></fa-icon> Delete
                </button>
            </div>
        </div>
    </div>
</div>


<div [ngClass]="{'window-overlay': displayDeleteModal}"></div>
<div class="popup" [ngClass]="{'open': displayDeleteModal }">
    <div class="popup-header">Delete Equipment
        <button type="button" class="btn-close float-end" aria-label="Close" (click)="closeDeleteModal()"></button>
    </div>
    <div class="popup-body">
        <div class="alert alert-danger">
            Are you sure you want to delete this equipment? Changes will be lost.
        </div>
        <hr>
    </div>
    <div class="popup-footer d-flex justify-content-end">
        <button class="btn btn-secondary me-2" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteEquipment()"><fa-icon [icon]="faTrash"></fa-icon> Delete
            Equipment</button>
    </div>
</div>

<app-contact-modal *ngIf="displayContactModal" (emitCancelContact)="closeContactModal()"
    [contextGuid]="energyEquipment.guid" [contactContext]="'energyEquipment'"
    [selectedContact]="viewContact" [companyGuid]="energyEquipment.companyId"></app-contact-modal>